/*Sentencias de DDL*/
/*Creacion de base de datos*/
create database TiendaMascota;
/*Habilitar la base de datos*/
use TiendaMascota;
/*Creacion de tablas*/
create table Mascota(
idMascota int primary key,
nombreMascota varchar (15),
generoMascota varchar (15),
razaMascota varchar (15),
cantidad int (10)
);
create table Cliente(
cedulaCliente int primary key,
nombreCliente varchar (15),
apellidoCliente varchar (15),
direccionCliente varchar (10),
telefono int (10),
idMascotaFK int
);
create table Producto(
codigoProducto int primary key,
nombreProducto varchar (15),
marca varchar (15),
precio float,
cedulaClienteFK int
);
create table Vacuna(
codigoVacuna int primary key,
nombreVacuna varchar (15),
dosisVacuna int (10),
enfermedad varchar (15)
);
create table Mascota_Vacuna(
codigoVacunaFK int,
idMascotaFK int,
enfermedad varchar (15)
);

/*crear las relaciones*/
alter table Cliente
add constraint FClienteMascota
foreign key (idMascotaFK)
references Mascota(idMascota);

alter table Producto
add constraint FKProductoCliente
foreign key (cedulaClienteFK)
references Cliente(cedulaCliente);

alter table Mascota_Vacuna
add constraint FKMV
foreign key (idMascotaFK)
references Mascota(idMascota );

alter table Mascota_Vacuna
add constraint FKVM
foreign key (codigoVacunaFK)
references Vacuna(codigoVacuna);


DELIMITER //
CREATE PROCEDURE InsertarMascota(IN idMascota INT, IN nombreMascota VARCHAR(15), IN generoMascota VARCHAR(15), IN razaMascota VARCHAR(15), IN cantidad INT, IN codigoVacuna INT, IN enfermedad VARCHAR(15))
BEGIN
    -- Insertar la nueva mascota en la tabla Mascota
    INSERT INTO Mascota (idMascota, nombreMascota, generoMascota, razaMascota, cantidad)
    VALUES (idMascota, nombreMascota, generoMascota, razaMascota, cantidad);
    
    -- Insertar la relaci√≥n en la tabla Mascota_Vacuna
    INSERT INTO Mascota_Vacuna (idMascotaFK, codigoVacunaFK, enfermedad)
    VALUES (idMascota, codigoVacuna, enfermedad);
    
END //
DELIMITER ;

/*procedimiento que vacunas se le han aplicado a una mascota y que enfermedad esta atacando*/
DELIMITER //
CREATE PROCEDURE ConsultarVacunasMascota(
    IN idMascota INT
)
BEGIN
    
    SELECT v.nombreVacuna, mv.enfermedad
    FROM Mascota m
    JOIN Mascota_Vacuna mv ON m.idMascota = mv.idMascotaFK
    JOIN Vacuna v ON mv.codigoVacunaFK = v.codigoVacuna
    WHERE m.idMascota = idMascota;
END //
DELIMITER ;
